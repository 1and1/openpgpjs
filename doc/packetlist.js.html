<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: packet/packetlist.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: packet/packetlist.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * This class represents a list of openpgp packets.
 * Take care when iterating over it - the packets themselves
 * are stored as numerical indices.
 * @requires enums
 * @requires packet
 * @requires packet/packet
 * @module packet/packetlist
 */

var packetParser = require('./packet.js'),
  packets = require('./all_packets.js'),
  enums = require('../enums.js');

/**
 * @constructor
 */
module.exports = function packetlist() {
  /** The number of packets contained within the list.
   * @readonly
   * @type {Integer} */
  this.length = 0;

  /**
   * Reads a stream of binary data and interprents it as a list of packets.
   * @param {String} A binary string of bytes.
   */
  this.read = function (bytes) {
    var i = 0;

    while (i &lt; bytes.length) {
      var parsed = packetParser.read(bytes, i, bytes.length - i);
      i = parsed.offset;

      var tag = enums.read(enums.packet, parsed.tag);
      var packet = new packets[tag]();

      this.push(packet);

      packet.read(parsed.packet);
    }
  };

  /**
   * Creates a binary representation of openpgp objects contained within the
   * class instance.
   * @returns {String} A binary string of bytes containing valid openpgp packets.
   */
  this.write = function () {
    var bytes = '';

    for (var i = 0; i &lt; this.length; i++) {
      var packetbytes = this[i].write();
      bytes += packetParser.writeHeader(this[i].tag, packetbytes.length);
      bytes += packetbytes;
    }

    return bytes;
  };

  /**
   * Adds a packet to the list. This is the only supported method of doing so;
   * writing to packetlist[i] directly will result in an error.
   */
  this.push = function (packet) {
    if (!packet) return;

    packet.packets = packet.packets || new packetlist();

    this[this.length] = packet;
    this.length++;
  };

  /**
  * Creates a new packetList with all packets that pass the test implemented by the provided function.
  */
  this.filter = function (callback) {

    var filtered = new packetlist();

    for (var i = 0; i &lt; this.length; i++) {
      if (callback(this[i], i, this)) {
        filtered.push(this[i]);
      }
    }

    return filtered;
  };

  /**
  * Creates a new packetList with all packets from the given types
  */
  this.filterByTag = function () {
    var args = Array.prototype.slice.call(arguments);
    var filtered = new packetlist();
    var that = this;

    for (var i = 0; i &lt; this.length; i++) {
      if (args.some(function(packetType) {return that[i].tag == packetType;})) {
        filtered.push(this[i]);
      }
    }

    return filtered;
  };

  /**
  * Executes the provided callback once for each element
  */
  this.forEach = function (callback) {
    for (var i = 0; i &lt; this.length; i++) {
      callback(this[i]);
    }
  };

  /**
   * Traverses packet tree and returns first matching packet
   * @param  {module:enums.packet} type The packet type
   * @return {module:packet/packet|null}      
   */
  this.findPacket = function (type) {
    var packetlist = this.filterByTag(type);
    if (packetlist.length) {
      return packetlist[0];
    } else {
      var found = null;
      for (var i = 0; i &lt; this.length; i++) {
        if (this[i].packets.length) {
          found = this[i].packets.findPacket(type);
          if (found) return found;
        }
      }
    }
    return null;
  };

  /**
   * Returns array of found indices by tag
   */
  this.indexOfTag = function () {
    var args = Array.prototype.slice.call(arguments);
    var tagIndex = [];
    var that = this;
    for (var i = 0; i &lt; this.length; i++) {
      if (args.some(function(packetType) {return that[i].tag == packetType;})) {
        tagIndex.push(i);
      }
    }
    return tagIndex;
  };

  /**
   * Returns slice of packetlist
   */
  this.slice = function (begin, end) {
    if (!end) {
      end = this.length;
    }
    var part = new packetlist();
    for (var i = begin; i &lt; end; i++) {
      part.push(this[i]);
    }
    return part;
  };

  /**
   * Concatenates packetlist or array of packets
   */
  this.concat = function (packetlist) {
    if (packetlist) {
      for (var i = 0; i &lt; packetlist.length; i++) {
        this.push(packetlist[i]);
      }
    }
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-armor.html">armor</a></li><li><a href="module-cleartext.html">cleartext</a></li><li><a href="module-config.html">config</a></li><li><a href="config.html">config/config</a></li><li><a href="localStorage.html">config/localStorage</a></li><li><a href="module-crypto.html">crypto</a></li><li><a href="cfb.html">crypto/cfb</a></li><li><a href="cipher.html">crypto/cipher</a></li><li><a href="aes.html">crypto/cipher/aes</a></li><li><a href="blowfish.html">crypto/cipher/blowfish</a></li><li><a href="cast5.html">crypto/cipher/cast5</a></li><li><a href="des.html">crypto/cipher/des</a></li><li><a href="twofish.html">crypto/cipher/twofish</a></li><li><a href="crypto.html">crypto/crypto</a></li><li><a href="hash.html">crypto/hash</a></li><li><a href="md5.html">crypto/hash/md5</a></li><li><a href="ripe-md.html">crypto/hash/ripe-md</a></li><li><a href="sha.html">crypto/hash/sha</a></li><li><a href="pkcs1.html">crypto/pkcs1</a></li><li><a href="public_key.html">crypto/public_key</a></li><li><a href="dsa.html">crypto/public_key/dsa</a></li><li><a href="elgamal.html">crypto/public_key/elgamal</a></li><li><a href="jsbn.html">crypto/public_key/jsbn</a></li><li><a href="rsa.html">crypto/public_key/rsa</a></li><li><a href="random.html">crypto/random</a></li><li><a href="signature.html">crypto/signature</a></li><li><a href="armor.html">encoding/armor</a></li><li><a href="base64.html">encoding/base64</a></li><li><a href="module-enums.html">enums</a></li><li><a href="module-key.html">key</a></li><li><a href="module-keyid.html">keyid</a></li><li><a href="keyring.html">keyring/keyring</a></li><li><a href="localstore.html">keyring/localstore</a></li><li><a href="module-message.html">message</a></li><li><a href="module-mpi.html">mpi</a></li><li><a href="module-openpgp.html">openpgp</a></li><li><a href="module-packet.html">packet</a></li><li><a href="compressed.html">packet/compressed</a></li><li><a href="literal.html">packet/literal</a></li><li><a href="marker.html">packet/marker</a></li><li><a href="one_pass_signature.html">packet/one_pass_signature</a></li><li><a href="packet.html">packet/packet</a></li><li><a href="packetlist.html">packet/packetlist</a></li><li><a href="public_key_.html">packet/public_key</a></li><li><a href="public_key_encrypted_session_key.html">packet/public_key_encrypted_session_key</a></li><li><a href="public_subkey.html">packet/public_subkey</a></li><li><a href="secret_key.html">packet/secret_key</a></li><li><a href="secret_subkey.html">packet/secret_subkey</a></li><li><a href="signature_.html">packet/signature</a></li><li><a href="sym_encrypted_integrity_protected.html">packet/sym_encrypted_integrity_protected</a></li><li><a href="sym_encrypted_session_key.html">packet/sym_encrypted_session_key</a></li><li><a href="symmetrically_encrypted.html">packet/symmetrically_encrypted</a></li><li><a href="trust.html">packet/trust</a></li><li><a href="user_attribute.html">packet/user_attribute</a></li><li><a href="userid.html">packet/userid</a></li><li><a href="module-s2k.html">s2k</a></li><li><a href="keyid.html">type/keyid</a></li><li><a href="mpi.html">type/mpi</a></li><li><a href="s2k.html">type/s2k</a></li><li><a href="module-util.html">util</a></li><li><a href="util.html">util/util</a></li></ul><h3>Classes</h3><ul><li><a href="JXG.Util.html">Util</a></li><li><a href="module-cleartext-CleartextMessage.html">CleartextMessage</a></li><li><a href="module-key-Key.html">Key</a></li><li><a href="module-key-SubKey.html">SubKey</a></li><li><a href="module-key-User.html">User</a></li><li><a href="module-message-Message.html">Message</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Mon Jan 06 2014 16:27:49 GMT+0100 (MEZ)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
